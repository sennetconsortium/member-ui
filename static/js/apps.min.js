"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}(function(){var ApiCall,App,ToastIt,_app,boundMethodCheck=function boundMethodCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new Error("Bound instance method accessed before binding")}};App=function(){function App(el,options){_classCallCheck(this,App);this.ops=options;this.el=$(el);this.tag="js-"+options.appName.toLowerCase();this.classes={busy:"is-busy"}}_createClass(App,[{key:"currentTarget",value:function currentTarget(e){return $(e.currentTarget)}}]);return App}();_app=function _app(fn){return $.fn[fn.name]=function(){var ops=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return $(this).each(function(i,element){ops.appName=fn.name;return $(this).data(fn.name,new fn(this,ops))})}};ApiCall=function(_App){_inherits(ApiCall,_App);var _super=_createSuper(ApiCall);function ApiCall(el,options){var _this;_classCallCheck(this,ApiCall);_this=_super.call(this,el,options);_this.handleBlob=_this.handleBlob.bind(_assertThisInitialized(_this));_this.isBusy=false;_this.options=options;_this.el=$(el);_this.events();return _this}_createClass(ApiCall,[{key:"showError",value:function showError(){return Toastify({text:"Something went wrong with your request.",style:{background:"#f8d7da",color:"#721c24","box-shadow":"0 3px 6px -1px rgb(0 0 0 / 12%), 0 10px 36px -4px rgb(232 77 151 / 30%)"}}).showToast()}},{key:"unBusy",value:function unBusy($el){this.isBusy=false;return $el.removeClass(this.classes.busy)}},{key:"handleBlob",value:function handleBlob(e,data){var $el,a,url;boundMethodCheck(this,ApiCall);$el=this.currentTarget(e);if(!data.size){this.showError();return this.unBusy($el)}else{a=document.createElement("a");url=window.URL.createObjectURL(data);a.href=url;a.download=$el.data("filename")||"SenNet-file";document.body.append(a);a.click();a.remove();window.URL.revokeObjectURL(url);return this.unBusy($el)}}},{key:"request",value:function request(e){var _this2=this;var $el,_xhrFields,url,xhrFields;e.preventDefault();this.isBusy=true;$el=this.currentTarget(e);url=$el.addClass(this.classes.busy).data("js-apicall")||this.options.url;_xhrFields=$el.data("xhrFields")||this.options.xhrFields||{};xhrFields={responseType:$el.data("responsetype")||this.options.responseType||"json"};xhrFields=$.extend(xhrFields,_xhrFields);return $.ajax({type:"GET"||$el.data("method")||this.options.method,url:url,xhrFields:xhrFields,success:function success(data){if(xhrFields.responseType==="blob"){_this2.handleBlob(e,data)}if(_this2.options.callback&&typeof _this2.options.callback==="function"){return _this2.options.callback(e,data)}},error:function error(xhr,textStatus,errorThrown){console.error(textStatus);_this2.showError();return _this2.unBusy($el)}})}},{key:"events",value:function events(){var _this3=this;return this.el.on("click",function(e){if(!_this3.isBusy){return _this3.request(e)}})}}]);return ApiCall}(App);_app(ApiCall);ToastIt=function(_App2){_inherits(ToastIt,_App2);var _super2=_createSuper(ToastIt);function ToastIt(el,options){var _this4;_classCallCheck(this,ToastIt);_this4=_super2.call(this,el,options);_this4.events();return _this4}_createClass(ToastIt,[{key:"handleToast",value:function handleToast(e){var text;text=this.currentTarget(e).data(this.tag);Toastify({text:text,ariaLive:"polite"}).showToast()}},{key:"events",value:function events(){var _this5=this;return this.el.on("click",function(e){if(!_this5.currentTarget(e).hasClass(_this5.classes.busy)){return _this5.handleToast(e)}})}}]);return ToastIt}(App);_app(ToastIt);(function(){$("document").ready(function(){$("[data-js-toastit]").ToastIt();$("[data-js-apicall]").ApiCall()})}).call(this)}).call(void 0);
